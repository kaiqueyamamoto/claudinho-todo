<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lista de Atividades</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body class="bg-light">
    <main class="container py-4 py-md-5">
      <div class="row g-4">
        <section class="col-12 col-lg-4">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <h1 class="h4 mb-3">Nova atividade</h1>
              <form id="task-form" class="vstack gap-3">
                <div>
                  <label for="task-title" class="form-label">Título</label>
                  <input
                    id="task-title"
                    class="form-control"
                    type="text"
                    placeholder="Ex.: Estudar Bootstrap"
                    required
                  />
                </div>
                <div>
                  <label for="task-description" class="form-label">Descrição</label>
                  <textarea
                    id="task-description"
                    class="form-control"
                    rows="3"
                    placeholder="Detalhes da atividade"
                  ></textarea>
                </div>
                <button type="submit" class="btn btn-primary w-100">Adicionar</button>
              </form>
            </div>
          </div>
        </section>

        <section class="col-12 col-lg-8">
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-body">
              <h2 class="h5 mb-3">Dashboard</h2>
              <div class="row g-3 text-center">
                <div class="col-12 col-md-4">
                  <div class="metric-box p-3 rounded-3 bg-primary-subtle">
                    <span class="d-block text-muted">Total</span>
                    <strong id="total-count" class="fs-3">0</strong>
                  </div>
                </div>
                <div class="col-12 col-md-4">
                  <div class="metric-box p-3 rounded-3 bg-success-subtle">
                    <span class="d-block text-muted">Concluídas</span>
                    <strong id="completed-count" class="fs-3">0</strong>
                  </div>
                </div>
                <div class="col-12 col-md-4">
                  <div class="metric-box p-3 rounded-3 bg-warning-subtle">
                    <span class="d-block text-muted">Pendentes</span>
                    <strong id="pending-count" class="fs-3">0</strong>
                  </div>
                </div>
              </div>
              <div class="mt-4">
                <div class="d-flex justify-content-between small mb-1">
                  <span>Progresso de conclusão</span>
                  <span id="progress-label">0%</span>
                </div>
                <div class="progress" role="progressbar" aria-label="Progresso" aria-valuemin="0" aria-valuemax="100">
                  <div id="progress-bar" class="progress-bar progress-bar-striped progress-bar-animated" style="width: 0%"></div>
                </div>
              </div>
            </div>
          </div>

          <div class="card border-0 shadow-sm">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap gap-2">
                <h2 class="h5 mb-0">Minhas atividades</h2>
                <button id="clear-completed" class="btn btn-outline-danger btn-sm" type="button">Limpar concluídas</button>
              </div>
              <ul id="task-list" class="list-group list-group-flush"></ul>
              <p id="empty-state" class="text-muted mb-0 text-center py-4">Nenhuma atividade cadastrada.</p>
            </div>
          </div>
        </section>
      </div>
    </main>

    <script>
      const STORAGE_KEY = 'todo-atividades';
      const taskForm = document.getElementById('task-form');
      const taskList = document.getElementById('task-list');
      const emptyState = document.getElementById('empty-state');
      const totalCount = document.getElementById('total-count');
      const completedCount = document.getElementById('completed-count');
      const pendingCount = document.getElementById('pending-count');
      const progressBar = document.getElementById('progress-bar');
      const progressLabel = document.getElementById('progress-label');
      const clearCompletedBtn = document.getElementById('clear-completed');

      function getTasks() {
        const raw = localStorage.getItem(STORAGE_KEY);
        return raw ? JSON.parse(raw) : [];
      }

      function saveTasks(tasks) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(tasks));
      }

      function updateDashboard(tasks) {
        const total = tasks.length;
        const completed = tasks.filter((task) => task.completed).length;
        const pending = total - completed;
        const percent = total ? Math.round((completed / total) * 100) : 0;

        totalCount.textContent = total;
        completedCount.textContent = completed;
        pendingCount.textContent = pending;
        progressLabel.textContent = percent + '%';
        progressBar.style.width = percent + '%';
        progressBar.setAttribute('aria-valuenow', String(percent));
      }

      function renderTasks() {
        const tasks = getTasks();
        taskList.innerHTML = '';

        if (!tasks.length) {
          emptyState.classList.remove('d-none');
        } else {
          emptyState.classList.add('d-none');
        }

        tasks.forEach((task) => {
          const li = document.createElement('li');
          li.className = 'list-group-item py-3';
          li.innerHTML = `
            <div class="d-flex justify-content-between align-items-start gap-3">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" ${task.completed ? 'checked' : ''} data-action="toggle" data-id="${task.id}" id="task-${task.id}">
                <label class="form-check-label ${task.completed ? 'text-decoration-line-through text-muted' : ''}" for="task-${task.id}">
                  <strong>${task.title}</strong>
                  ${task.description ? `<small class="d-block mt-1">${task.description}</small>` : ''}
                </label>
              </div>
              <button class="btn btn-sm btn-outline-secondary" type="button" data-action="delete" data-id="${task.id}">Excluir</button>
            </div>
          `;
          taskList.appendChild(li);
        });

        updateDashboard(tasks);
      }

      function addTask(title, description) {
        const tasks = getTasks();
        const newTask = {
          id: Date.now(),
          title,
          description,
          completed: false,
        };
        tasks.unshift(newTask);
        saveTasks(tasks);
        renderTasks();
      }

      function toggleTask(id) {
        const tasks = getTasks().map((task) =>
          task.id === id ? { ...task, completed: !task.completed } : task
        );
        saveTasks(tasks);
        renderTasks();
      }

      function deleteTask(id) {
        const tasks = getTasks().filter((task) => task.id !== id);
        saveTasks(tasks);
        renderTasks();
      }

      function clearCompleted() {
        const tasks = getTasks().filter((task) => !task.completed);
        saveTasks(tasks);
        renderTasks();
      }

      taskForm.addEventListener('submit', (event) => {
        event.preventDefault();
        const titleInput = document.getElementById('task-title');
        const descriptionInput = document.getElementById('task-description');

        addTask(titleInput.value.trim(), descriptionInput.value.trim());
        taskForm.reset();
        titleInput.focus();
      });

      taskList.addEventListener('click', (event) => {
        const action = event.target.dataset.action;
        const id = Number(event.target.dataset.id);

        if (action === 'toggle') {
          toggleTask(id);
        }

        if (action === 'delete') {
          deleteTask(id);
        }
      });

      taskList.addEventListener('change', (event) => {
        if (event.target.dataset.action === 'toggle') {
          toggleTask(Number(event.target.dataset.id));
        }
      });

      clearCompletedBtn.addEventListener('click', clearCompleted);

      renderTasks();
    </script>
  </body>
</html>
